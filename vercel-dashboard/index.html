<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    <title>Tender Intelligence Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header class="main-header">
            <h1>Tender Intelligence</h1>
            <p class="subtitle"><span class="status"></span>TES & Phakathi decision layer</p>
        </header>

        <div id="print-report-header" class="print-header">
            <h1>Tender Intelligence ‚Äì Daily Report</h1>
            <p class="print-subtitle">TES &amp; Phakathi decision layer</p>
            <p class="print-meta">
                <span id="print-last-sync">Last sync: ‚Äì</span>
                <span> | </span>
                <span id="print-next-run">Next run: Daily 08:00</span>
            </p>
            <div class="print-kpis">
                <div class="print-kpi">
                    <span class="label">Total tenders today</span>
                    <span class="value" id="print-total-tenders">‚Äì</span>
                </div>
                <div class="print-kpi">
                    <span class="label">TES-fit tenders</span>
                    <span class="value" id="print-tes-tenders">‚Äì</span>
                </div>
                <div class="print-kpi">
                    <span class="label">Phakathi-fit tenders</span>
                    <span class="value" id="print-phakathi-tenders">‚Äì</span>
                </div>
            </div>
        </div>

        <nav class="tab-nav">
            <button class="tab-btn active" onclick="showTab('dashboard')">üìä Dashboard</button>
            <button class="tab-btn" onclick="showTab('calendar')">üìÖ Bid Calendar</button>
            <button class="tab-btn" onclick="showTab('sources')">üìÇ Sources</button>
        </nav>

        <!-- DASHBOARD TAB -->
        <div id="dashboard" class="tab-content active">
            <div class="export-actions">
                <button id="export-pdf-btn" class="export-btn">Export as PDF</button>
                <button id="export-email-btn" class="export-btn secondary">Email summary</button>
            </div>
            <section>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value total">7</div>
                        <div class="stat-label">Total tenders today</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value tes-color">1</div>
                        <div class="stat-label">TES-fit tenders</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value phakathi-color">3</div>
                        <div class="stat-label">Phakathi-fit tenders</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value high">0</div>
                        <div class="stat-label">High-priority tenders</div>
                    </div>
                </div>
                <div class="last-sync">
                    <span>üîÑ Last sync:</span>
                    <span id="last-sync-text">10 Dec 2025, 13:50</span>
                    <span> | Next run:</span>
                    <span id="next-run-text">Daily 08:00</span>
                </div>
                <div id="next-run-countdown" class="next-run-countdown"></div>
                <div id="data-status" class="data-status" role="status" aria-live="polite">
                    <div class="data-status-left">
                        <span id="data-status-pill" class="data-pill warn">Data: loading‚Ä¶</span>
                        <span>Source: <strong id="data-status-source">‚Äì</strong></span>
                        <span>Records: <strong id="data-status-count">‚Äì</strong></span>
                        <span>Updated: <strong id="data-status-updated">‚Äì</strong></span>
                    </div>
                    <div id="data-status-error" class="data-status-error"></div>
                </div>
            </section>

            <section class="section pipeline-section">
                <h2>üöÄ Opportunity Pipeline</h2>
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value total">7</div>
                        <div class="stat-label">Total active</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value tes-color">1</div>
                        <div class="stat-label">TES</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value phakathi-color">3</div>
                        <div class="stat-label">Phakathi</div>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <p style="color: #888; margin-bottom: 8px;">Priority mix</p>
                    <div style="background: rgba(255,255,255,0.05); border-radius: 12px; overflow: hidden; height: 18px; display: flex;">
                        <span style="width: 10%; background: rgba(255,107,107,0.4);" title="High"></span>
                        <span style="width: 70%; background: rgba(254,202,87,0.4);" title="Medium"></span>
                        <span style="width: 20%; background: rgba(72,219,251,0.4);" title="Low"></span>
                    </div>
                    <div style="display: flex; justify-content: space-between; color: #888; font-size: 0.85rem; margin-top: 6px;">
                        <span>High</span>
                        <span>Medium</span>
                        <span>Low</span>
                    </div>
                </div>
            </section>

            <section class="section ai-section">
                <h2>ü§ñ AI Fit & Risk</h2>
                <div style="display: grid; gap: 12px;">
                    <div style="display: grid; grid-template-columns: 140px 1fr 70px; align-items: center; gap: 12px;">
                        <span style="color: #ccc;">Fit score</span>
                        <div style="background: rgba(255,255,255,0.05); border-radius: 10px; height: 12px; overflow: hidden;">
                            <div style="width: 62%; height: 100%; background: linear-gradient(90deg, #48dbfb, #667eea);"></div>
                        </div>
                        <span style="text-align: right; color: #fff;">62%</span>
                    </div>
                    <div style="display: grid; grid-template-columns: 140px 1fr 70px; align-items: center; gap: 12px;">
                        <span style="color: #ccc;">Revenue score</span>
                        <div style="background: rgba(255,255,255,0.05); border-radius: 10px; height: 12px; overflow: hidden;">
                            <div style="width: 48%; height: 100%; background: linear-gradient(90deg, #feca57, #ff9f43);"></div>
                        </div>
                        <span style="text-align: right; color: #fff;">48%</span>
                    </div>
                    <div style="display: grid; grid-template-columns: 140px 1fr 70px; align-items: center; gap: 12px;">
                        <span style="color: #ccc;">Suitability score</span>
                        <div style="background: rgba(255,255,255,0.05); border-radius: 10px; height: 12px; overflow: hidden;">
                            <div style="width: 55%; height: 100%; background: linear-gradient(90deg, #a29bfe, #764ba2);"></div>
                        </div>
                        <span style="text-align: right; color: #fff;">55%</span>
                    </div>
                    <div style="display: grid; grid-template-columns: 140px 1fr 70px; align-items: center; gap: 12px;">
                        <span style="color: #ccc;">Risk score (lower is better)</span>
                        <div style="background: rgba(255,255,255,0.05); border-radius: 10px; height: 12px; overflow: hidden;">
                            <div style="width: 28%; height: 100%; background: linear-gradient(90deg, #ff6b6b, #ff8787);"></div>
                        </div>
                        <span style="text-align: right; color: #fff;">28%</span>
                    </div>
                </div>
            </section>

            <section class="section active-tenders-section">
                <h2>üìã Active Tenders</h2>
                <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px; align-items: center;">
                    <label style="color: #888; font-size: 0.9rem;">Company
                        <select id="companyFilter" onchange="filterTenders(this.value)" style="margin-left: 8px; padding: 8px 10px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: #fff;">
                            <option value="all">All</option>
                            <option value="TES">TES</option>
                            <option value="Phakathi">Phakathi</option>
                        </select>
                    </label>
                    <label style="color: #888; font-size: 0.9rem;">Priority
                        <select id="priorityFilter" onchange="filterTenders(this.value)" style="margin-left: 8px; padding: 8px 10px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: #fff;">
                            <option value="all">All</option>
                            <option value="HIGH">High</option>
                            <option value="MEDIUM">Medium</option>
                            <option value="LOW">Low</option>
                        </select>
                    </label>
                    <label class="scope-toggle">
                        <input type="checkbox" id="hide-out-of-scope" />
                        Hide out-of-scope
                    </label>
                    <button id="refresh-data-btn" class="refresh-data-btn" type="button">Refresh data</button>
                </div>
                <div style="overflow-x: auto;">
                    <table class="tenders-table" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="text-align: left; color: #888;">
                                <th style="padding: 10px;">Title</th>
                                <th style="padding: 10px;">Source</th>
                                <th style="padding: 10px;">Company</th>
                                <th style="padding: 10px;">Priority</th>
                                <th style="padding: 10px;">Close date</th>
                                <th style="padding: 10px;">Fit</th>
                                <th style="padding: 10px;">Revenue</th>
                                <th style="padding: 10px;">Risk</th>
                                <th style="padding: 10px;">Status</th>
                                <th style="padding: 10px;">Scope</th>
                                <th style="padding: 10px;">Decision</th>
                                <th style="padding: 10px;">Link</th>
                            </tr>
                        </thead>
                        <tbody id="tenderList" class="tender-list"></tbody>
                    </table>
                </div>
            </section>

            <section class="section">
                <h2>üõ∞Ô∏è Scraper & Source Health</h2>
                <div class="companies">
                    <div class="company-card" style="border-color: rgba(72,219,251,0.3);">
                        <div class="company-name" style="color: #48dbfb;">Rand Water</div>
                        <div class="company-focus">Status: <span style="color: #48dbfb;">OK</span></div>
                        <div class="company-keywords">
                            <span class="keyword">Last run: 06:00</span>
                            <span class="keyword">Tenders found: 4</span>
                            <span class="keyword">Failures (7d): 0</span>
                        </div>
                    </div>
                    <div class="company-card" style="border-color: rgba(254,202,87,0.3);">
                        <div class="company-name" style="color: #feca57;">Johannesburg Water</div>
                        <div class="company-focus">Status: <span style="color: #feca57;">Warning</span></div>
                        <div class="company-keywords">
                            <span class="keyword">Last run: 05:45</span>
                            <span class="keyword">Tenders found: 3</span>
                            <span class="keyword">Failures (7d): 1</span>
                        </div>
                    </div>
                    <div class="company-card" style="border-color: rgba(255,107,107,0.3);">
                        <div class="company-name" style="color: #ff6b6b;">National Treasury</div>
                        <div class="company-focus">Status: <span style="color: #ff6b6b;">Error</span></div>
                        <div class="company-keywords">
                            <span class="keyword">Last run: 04:30</span>
                            <span class="keyword">Tenders found: 0</span>
                            <span class="keyword">Failures (7d): 3</span>
                        </div>
                    </div>
                </div>
            </section>

            <section class="section">
                <h2>‚öôÔ∏è Automation & Logs</h2>
                <ul class="tender-list">
                    <li class="tender-item">
                        <div class="tender-content">
                            <div class="tender-info">
                                <div class="tender-title">2025-12-10 06:00 ‚Ä¢ Daily scan ‚Ä¢ Tenders found: 7</div>
                                <div class="tender-meta">
                                    <span>Status: Success</span>
                                    <span>Notes: Fresh scrape, no errors</span>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="tender-item">
                        <div class="tender-content">
                            <div class="tender-info">
                                <div class="tender-title">2025-12-09 18:00 ‚Ä¢ Manual CSV ‚Ä¢ Tenders found: 2</div>
                                <div class="tender-meta">
                                    <span>Status: Partial</span>
                                    <span>Notes: Rand Water PDF timed out</span>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="tender-item">
                        <div class="tender-content">
                            <div class="tender-info">
                                <div class="tender-title">2025-12-09 07:00 ‚Ä¢ Weekly report ‚Ä¢ Tenders found: 9</div>
                                <div class="tender-meta">
                                    <span>Status: Success</span>
                                    <span>Notes: Report emailed to TES & Phakathi</span>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </section>
        </div>

        <!-- CALENDAR TAB -->
        <div id="calendar" class="tab-content">
            <div class="section">
                <h2>üìÖ Bid Calendar</h2>
                <div class="calendar-nav">
                    <button onclick="changeMonth(-1)">‚Üê Previous</button>
                    <span class="calendar-month" id="calendarMonth"></span>
                    <button onclick="changeMonth(1)">Next ‚Üí</button>
                </div>
                <div class="calendar">
                    <div class="calendar-header">Sun</div>
                    <div class="calendar-header">Mon</div>
                    <div class="calendar-header">Tue</div>
                    <div class="calendar-header">Wed</div>
                    <div class="calendar-header">Thu</div>
                    <div class="calendar-header">Fri</div>
                    <div class="calendar-header">Sat</div>
                </div>
                <div class="calendar" id="calendarGrid"></div>
                <div id="dayTenders" style="margin-top: 20px;"></div>
            </div>
        </div>

        <!-- SOURCES TAB -->
        <div id="sources" class="tab-content">
            <div class="section">
                <h2>üè¢ Company Focus Areas</h2>
                <div class="companies">
                    <div class="company-card" style="border-color: rgba(72,219,251,0.5);">
                        <div class="company-name" style="color: #48dbfb;">üíß TES</div>
                        <div class="company-focus">Water Treatment & Cooling Specialists</div>
                        <div class="company-keywords">
                            <span class="keyword">Water Treatment</span>
                            <span class="keyword">Cooling Systems</span>
                            <span class="keyword">Chemical Dosing</span>
                            <span class="keyword">RO Systems</span>
                            <span class="keyword">Boiler Treatment</span>
                        </div>
                    </div>
                    <div class="company-card" style="border-color: rgba(254,202,87,0.5);">
                        <div class="company-name" style="color: #feca57;">‚öôÔ∏è Phakathi</div>
                        <div class="company-focus">Mechanical & Electrical Solutions</div>
                        <div class="company-keywords">
                            <span class="keyword">Pumps</span>
                            <span class="keyword">Mechanical</span>
                            <span class="keyword">Fabrication</span>
                            <span class="keyword">Switchgear</span>
                            <span class="keyword">Valves</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2>üìä Data Sources (11 Active)</h2>
                <div class="companies">
                    <div class="company-card" style="border-color: rgba(72,219,251,0.3);">
                        <div class="company-name" style="color: #48dbfb;">üèõÔ∏è Municipalities</div>
                        <div class="company-keywords">
                            <span class="keyword">Ekurhuleni</span>
                            <span class="keyword">Tshwane</span>
                            <span class="keyword">Cape Town</span>
                            <span class="keyword">eThekwini</span>
                        </div>
                    </div>
                    <div class="company-card" style="border-color: rgba(254,202,87,0.3);">
                        <div class="company-name" style="color: #feca57;">‚ö° SOEs & Utilities</div>
                        <div class="company-keywords">
                            <span class="keyword">Eskom</span>
                            <span class="keyword">Transnet</span>
                            <span class="keyword">Rand Water</span>
                            <span class="keyword">Sasol</span>
                            <span class="keyword">SANEDI</span>
                            <span class="keyword">Johannesburg Water</span>
                            <span class="keyword">Umgeni Water</span>
                        </div>
                    </div>
                    <div class="company-card" style="border-color: rgba(255,107,107,0.3);">
                        <div class="company-name" style="color: #ff6b6b;">‚õèÔ∏è Mining</div>
                        <div class="company-keywords">
                            <span class="keyword">Anglo American</span>
                            <span class="keyword">Harmony Gold</span>
                            <span class="keyword">Seriti</span>
                            <span class="keyword">Exxaro</span>
                        </div>
                    </div>
                    <div class="company-card" style="color: #a29bfe; border-color: rgba(162,155,254,0.3);">
                        <div class="company-name">üè¶ National Treasury</div>
                        <div class="company-keywords">
                            <span class="keyword">eTenders Portal</span>
                            <span class="keyword">Government Bids</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>üõ∞Ô∏è Scraper Health</h2>
                <div id="scraper-health-cards" class="health-grid" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 10px;"></div>
            </div>
        </div>
        
        <footer>
            <p>Tender Intelligence System v3.0 | TES & Phakathi</p>
            <p>Automated scans: Daily 6AM | Weekly Reports: Monday 7AM</p>
        </footer>
    </div>

    <div id="tender-modal-backdrop" class="tender-modal-backdrop hidden">
        <div class="tender-modal">
            <div class="tender-modal-header">
                <h2 id="modal-tender-title"></h2>
                <button id="modal-close-btn" class="modal-close-btn">√ó</button>
            </div>
            <div class="tender-modal-meta">
                <div><span id="modal-tender-source"></span> ¬∑ <span id="modal-tender-company"></span> ¬∑ <span id="modal-tender-priority"></span></div>
                <div>Close date: <span id="modal-tender-close-date"></span> ¬∑ <span id="modal-tender-days-remaining"></span></div>
            </div>
            <div class="tender-modal-scores">
                <div>Fit score: <span id="modal-fit-score"></span></div>
                <div>Revenue score: <span id="modal-revenue-score"></span></div>
                <div>Suitability score: <span id="modal-suitability-score"></span></div>
                <div>Risk score (lower is better): <span id="modal-risk-score"></span></div>
            </div>
            <div class="tender-modal-body">
                <h3>Description</h3>
                <p id="modal-tender-description"></p>
                <h3>Notes</h3>
                <p id="modal-tender-notes"></p>
                <div class="tender-modal-ai">
                    <h3>AI Insight</h3>
                    <p id="modal-tender-ai-insight">Analyzing...</p>
                    <div class="tender-modal-ai-reco">
                        <h3>AI Recommendation</h3>
                        <p id="modal-tender-ai-reco"></p>
                    </div>
                </div>
            </div>
            <div class="tender-modal-footer">
                <button id="modal-open-link" class="modal-open-link-btn">Open tender on source site ‚Üó</button>
            </div>
        </div>
    </div>
    
    <script src="script.js"></script>
    <div style="opacity:.6;font-size:12px;margin-top:12px">
      Build marker: V3 UI present ¬∑ commit 377e345+
    </div>
</body>
</html>
